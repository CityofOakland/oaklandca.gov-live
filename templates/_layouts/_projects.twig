{% extends '_content' %}

{% block banner %}
  {% if entry.banner|length %}
    {% set banner = entry.banner.one() %}
    <div class="leading-normal aspect-ratio-box aspect-ratio-1/4 banner">
      <div class="object-cover pt-2 pb-8 leading-none aspect-ratio md:pt-4 md:pb-6 min-h-2-1/2 md:min-h-4">
        <figure class="absolute inset-0 z-0">
          <img
            class="absolute inset-0 z-0 object-cover w-full h-full"
            style="object-position:{{ banner.getFocalPoint('asCss') }};"
            src="{{ banner.url }}"
            alt="{{ banner.title ?? banner.filename }}">
        </figure>
        <div class="container py-0">
          {% include "_components/partials/_breadcrumbs.twig" %}
        </div>
      </div>
    </div>
  {% else %}
    <div class="leading-none banner">
      <div class="container pt-2 pb-8 md:pt-4 md:pb-6">
        <div class="absolute inset-0 z-0 bg-transparent-oakland-roots"></div>
        {% include "_components/partials/_breadcrumbs.twig" %}
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block content %}
  {% js at endBody %}
    {% include "_js/timeline.js" %}
    timeline(document.querySelectorAll('.timeline'));
  {% endjs %}

  {% if entry.timeline.exists() %}
    <h2>Timeline</h2>
    <div class="timeline" data-vertical-start-position="right">
      <div class="timeline__wrap">
        <div class="timeline__items">
          {% for block in entry.timeline.all() %}
            <div class="timeline__item">
              <div class="timeline__content">
                <h3 class="my-0 text-xl font-bold">{{ block.milestoneName }}</h3>
                <p>{{ block.milestoneDates }}</p>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}

  {% if entry.projectMapImage.exists() %}
    <h2>Project Location</h2>
    <figure class="block w-full">
      <img src="{{ entry.projectMapImage.one.getUrl('medium43') }}" class="block">
    </figure>
  {% endif %}

  {% if entry.projectBeforePhoto.exists() and entry.projectAfterPhoto.exists() %}
    <div class="md:flex md:flex-row">
      <div class="md:pr-4 md:w-1/2">
        <h3>Current</h3>
        <figure class="block w-full mt-4">
          <img src="{{ entry.projectBeforePhoto.one.getUrl('medium43') }}" class="block">
        </figure>
      </div>
      <div class="md:pl-4 md:w-1/2">
        <h3>Projected/After</h3>
        <figure class="block w-full mt-4">
          <img src="{{ entry.projectAfterPhoto.one.getUrl('medium43') }}" class="block">
        </figure>
      </div>
    </div>
    <div>
      {% include '_components/_button' with {
        class: 'mt-4',
        url: entry.externalPhotoGallery.url,
        text: entry.externalPhotoGallery.text,
        target: entry.externalPhotoGallery.target,
      } %}
    </div>
  {% endif %}

  {% if entry.about %}
    <h2>About</h2>
    {{ entry.about }}
  {% endif %}

  {% if entry.fundingLogos.exists() %}
    <h2>Project Funding</h3>
    <div class="flex flex-wrap items-center -mx-4 mt-6">
      {% for logo in entry.fundingLogos.all() %}
        <figure class="w-full mx-4 mb-4 sm:w-1/2 md:w-1/3 lg:w-1/5">
          <img class="block w-full h-auto mx-auto" src="{{ logo.url }}" alt="{{ logo.title }}">
        </figure>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}

{% block prefooter %}
  {% set addresses = entry.addresses %}
  {% if addresses or entry.phoneNumbers | length or entry.emailAddress %}
    <section>
      <div class="container components components-format">
        <h2>Contact Us</h2>
        <div class="mt-4 lg:flex">
          {% if addresses|length %}
            <div class="lg:w-1/2 lg:pr-8">
              <h4 class="font-bold">Address{% if addresses|length > 1 %}es{% endif %}</h3>
              {% for block in addresses.all() %}
                {% switch block.type %}
                  {% case "location" %}
                    <p>{{ block.locationName }}</p>
                    {% include '_partials/_elements/_address.twig' with { location: block } %}
                  {% case "onlineLocation" %}
                    <div>
                      {% if block.locationName %}<h4>{{ block.locationName }}</h4>{% endif %}
                      {{ block.locationDescription }}
                      {% include '_components/_button' with {
                        class: 'mt-4 mr-0 mb-0',
                        url: block.webAddress,
                        text: block.locationName,
                      } %}
                    </div>
                  {% default %}
                {% endswitch %}
              {% endfor %}
              {{ entry.addressExtended }}
            </div>
          {% endif %}
          <div class="{% if addresses %} lg:w-1/2 lg:pl-8 {% else %} flex-1 {% endif %}">
            {% if entry.phoneNumbers | length %}
              <h4 class="font-bold">Phone Numbers</h3>
              <ul class="list-none">
                {% for phone in entry.phoneNumbers %}
                  {% include '_partials/_elements/_phone-numbers.twig' %}
                {% endfor %}
              </ul>
            {% endif %}
            {% if entry.emailAddress | length %}
              <h4 class="font-bold">Email Address</h3>
              <ul class="list-none">
                <li>
                  <a href="mailto:{{ entry.emailAddress }}">{{ entry.emailAddress }}</a>
                </li>
              </ul>
            {% endif %}
            {% if entry.openHours | length %}
              <h4 class="font-bold">Open Hours</h3>
              {% for item in entry.openHours %}
                {% if item.hoursTitle | length %}
                  <h4 class="text-lg">{{ item.hoursTitle }}</h4>
                {% endif %}
                <dl>
                  {% for day in item.hours.getRange(1, 0) %}
                    {% include '_partials/_elements/_hours.twig' %}
                  {% endfor %}
                </dl>
              {% endfor %}
            {% endif %}
            {# TODO: Move Topics, processes (negligible) and officials to matrix immediately #}
            {% if entry.boardHours | length %}
              <h4 class="font-bold">Business Hours</h3>
              {{ entry.boardHours }}
            {% endif %}
            {% include '_partials/_elements/_social-media.twig' %}
          </div>
        </div>
      </div>
    </section>
  {% endif %}
{% endblock %}

{% block sidebar %}
  <hr>
  <h4>Project Updates</h4>
  {% set relatedNews = craft.entries.section('news').relatedTo(entry).all() %}
  {% if relatedNews|length %}
    <ul class="list-none pl-0">
      {% for entry in relatedNews %}
        <li class="mb-4"><a href="{{ entry.url }}">{{ entry.title }}</a></li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No updates, yet! Check back soon!</p>
  {% endif %}

  {% if entry.relatedProjectEntries|length %}
    <hr>
    <h4>Related Pages</h4>
    <ul class="list-none pl-0">
      {% for entry in entry.relatedProjectEntries.all() %}
        <li class="mb-4"><a href="{{ entry.url }}">{{ entry.title }}</a></li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if entry.projectDocuments|length %}
    <hr>
    <h4>Project Documents</h4>
    <ul class="!pt-0 mt-4 ul-icons related">
    {% for document in entry.projectDocuments.all() %}
      <li>
        <a href="{{ document.url }}">
          {{ svg( '@webroot/dist/img/icon-document.svg') }} {{ document.title }}
        </a>
      </li>
    {% endfor %}
    </ul>
  {% endif %}
{% endblock %}
