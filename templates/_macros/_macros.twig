{% macro card(entry, dark, arrow) %}
  <li>
    <a class="card {{ dark ? 'dark' : '' }}" href="{{ entry.url }}">
      <h4 class="flex justify-between pb-4 {{ dark ? 'text-gray-800' : 'text-green-700' }}"><span>{{ entry.title }}</span> {% if arrow %}<span>&rarr;</span>{% endif %}</h4>
      <div class="text-gray-800 clamp">{{ entry.summary }}</div>
    </a>
  </li>
{% endmacro %}

{% macro relatedSectionCount(entry, relations) %}
  {% set relCount = false %}
  {% for relation in relations %}
    {% set relSectionHandle = relation[0] %}
    {% set relType = relation[1] %}
    {% set isEntries = (relType == "entries") ? true : false %}
    {% set hasRels = isEntries ? craft.entries.section(relSectionHandle).relatedTo(entry) : craft.calendar.events({calendar: relSectionHandle}).relatedTo(entry) %}
    {% set relCount = true %}
    {% return relCount %}
  {% endfor %}
{% endmacro %}

{% macro relatedEntry(entry, relSection) %}
  {% set relSectionHandle = relSection[0] %}
  {% set relType = relSection[1] %}
  {% set isEntries = (relType == "entries") ? true : false %}
  {% set hasRels = isEntries ? craft.entries.section(relSectionHandle).relatedTo(entry) : craft.calendar.events({calendar: relSectionHandle}).relatedTo(entry) %}
  {% if hasRels | length %}
    {% set section = entry.section %}
    {% set relSection = isEntries ? craft.app.sections.getSectionByHandle(relSectionHandle) : craft.calendar.calendar({handle: relSectionHandle}) %}
    {% set urlBase = relSectionHandle | kebab %}
    {% set relUrl = "/" ~ urlBase ~ "/related-to/" ~ section.handle ~ "/" ~ entry.slug %}
    {% include "_partials/_elements/_title-cards" with { title: relSection.name, url: relUrl} %}
  {% endif %}
{% endmacro %}

{% macro dates() %}
  {{ renderRangepicker(
    'Upcoming Meetings Only',
    'Past and Upcoming Meetings',
    'Past Meetings Only',
  )|raw }}

  <div class="flex flex-wrap justify-between items-center -mx-3">
    <div class="w-full xl:w-2/5 px-3 mt-2">
      <label class="flex items-center" for="start_date" style="padding: 0;margin-bottom:0;">From Date:</label>
    </div>
    <div class="w-full xl:w-3/5 px-3 mt-2">
      {{ renderMonthpicker()|raw }}
    </div>
    <div class="w-full xl:w-2/5 px-3 mt-2">
      <label class="flex items-center" for="end_date" style="padding: 0;margin-bottom:0;">To Date:</label>
    </div>
    <div class="w-full xl:w-3/5 px-3 mt-2">
      {{ renderMonthpicker('end')|raw }}
    </div>
  </div>
{% endmacro %}

{% macro select(label, id, name, options, defaultOption) %}
  <label for="{{ id }}">
    {{ label }}
    <select class="shadow-form" name="{{ name }}">
      {% if defaultOption %}
        <option value="">{{ defaultOption }}</option>
      {% endif %}
      {% for option in options %}
        {% for value, key in option %}
          <option value="{{ value }}" {{ craft.app.request.getQueryParam(name) and craft.app.request.getQueryParam(name)  == value  ? 'selected' : ''  }}>{{ key }}</option>
        {% endfor %}
      {% endfor %}
    </select>
  </label>
{% endmacro %}

{% macro textInput(label, id, name, placeholder) %}
  <label for="{{ id }}">
    {{ label }}
    <input class="shadow-form" id="{{ id }}" name="{{ name }}" type="text" placeholder="{{ placeholder }}" value="{{ craft.app.request.getQueryParam(name) ?? craft.app.request.getQueryParam(name) }}">
  </label>
{% endmacro %}

{% macro tableBuilder(object, columns) %}
  <table class="w-full text-sm border border-cool-gray-500">
    <thead>
      <tr>
        {% for col in 1..columns %}
          {% set colAttrib = 'column' ~ col ~ 'Heading' %}
          {% set widthAttrib = 'column' ~ col ~ 'Width' %}
          <th class="px-3 py-1 text-white border bg-cool-gray-500 border-cool-gray-500" style="width: {{ attribute(object, widthAttrib) ~ '%' ?? '' }}">{{ attribute(object, colAttrib) }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in object.table.all() %}
        <tr class="odd:bg-white even:bg-cool-gray-100">
          {% for col in 1..columns %}
            {% set colAttrib = 'column' ~ col ~ 'Cell' %}
            <td class="p-4 align-top border body-text border-cool-gray-500">{{ attribute(row, colAttrib) | retconAttr( '*', { 'class' : 'last:mb-0' }, false ) }}</td>
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endmacro %}

{% macro videoEmbed(videoUrl, videoTitle) %}
  {% set splitVideoUrl = videoUrl | split('://')[1] | split('&')[0] %}
  {% if splitVideoUrl starts with 'oakland.granicus.com' %}
    {% set embed = "https://" ~ splitVideoUrl ~ "&starttime=undefined&stoptime=undefined&autostart=0&embed=1" %}
  {% else %}
    {% set embed = craft.videoEmbedder.getEmbedUrl(videoUrl) %}
  {% endif %}
  {% if embed | length %}
    {% if videoTitle %}
      <p class="mt-4 mb-2 font-bold">{{ videoTitle }}</p>
    {% endif %}
    <div class='mb-12 embed-container'>
      <iframe src='{{ embed }}' frameborder='0' allowfullscreen="allowfullscreen"></iframe>
    </div>
  {% else %}
    <p>
      <a href="{{ videoUrl }}" target="_blank">{{ videoTitle }}: ({{ videoUrl }})</a>
    </p>
  {% endif %}
{% endmacro %}