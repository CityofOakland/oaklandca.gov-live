{% if currentUser %}<!-- Begin {{ _self }} -->{% endif %}
{# Get the manually selected featured entry, if it exists. #}
{% set featuredEntry = globalNews.featuredNewsItem.one() ?? null %}
{# Get the first news entry that is marked as an official press release and has a main image. #}
{% set autoFeaturedEntry =  craft.entries.section("news").officialPressRelease(true).newsImage(":notempty:").one() ?? null %}

{# Get the manually selected regular entries, if they exist. #}
{% set selectedEntries = globalNews.news ?? null %}
{% set selectedIds = selectedEntries is defined ? selectedEntries.ids() : [] %}
{#{% set relatedEntryIds = entry is defined
  ? entry.myFieldHandle.ids()
  : [] %}#}

{# If the featured entry is selected, check to see if it is older than one month since being posted.
	 If it is, then use the previously set autoFeaturedEntry. Othe #}
{% if featuredEntry %}
	{% set expireDate = featuredEntry.postDate|date_modify('+1 month') %}
	{% set isExpired = expireDate <= now %}
	{% if isExpired %}
		{% set featuredEntry = autoFeaturedEntry %}
	{% endif %}
{% else %}
	{% set featuredEntry = autoFeaturedEntry %}
{% endif %}

{# Get the featured entryâ€™s ID #}
{% set featuredId = featuredEntry.id() %}

{# If the news have been manually selected, use them, otherwise, get them automatically #}
{% if selectedEntries %}
	{% set selectedNews = selectedIds %}
{% else %}
	{# Get the IDs of the global news #}
	{% set selectedNews = craft.entries.section("news").officialPressRelease(true).id("not #{featuredId}").ids() ?? null %}
{% endif %}

{{ include("_components/_newsCards/index.twig", {
	params: {
		background: "bg-white",
		baseRelationId: 17939,
		heading: "News",
		featuredEntry: featuredEntry,
		selectedEntries: selectedNews
	}
}) }}
{% if currentUser %}<!-- End {{ _self }} -->{% endif %}