{% set meetings  = craft.entries.section('meetings').date(['>= ' ~ now|date('Y-m-d')]).order('date asc').limit(3).relatedTo(entry) %}

{% if block.meetings|length %}
  {% set meetings = block.meetings %}
{% else %}
  {% if meetings|length == 0 %}
    {% set meetings  = craft.entries.section('meetings').order('date desc').limit(3).relatedTo(entry) %}
  {% endif %}
{% endif %}

<div class="{% if not loop.last %}mb-12{% endif %}">
  {% include "_partials/_content-builder/_blocks/_elements/_heading.twig" %}
  <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
    {% for entry in meetings %}
    <a class="shadow card default" href="{{ entry.url }}">
      <h4><span>{% if entry.meetingStatus and entry.meetingStatus.value and entry.meetingStatus.value !== 'default' %}{{ entry.meetingStatus.label }} - {% endif %}{{ entry.title }}</span></h4>
      {% if entry.type == 'meetingsImported' %}
        <p class="flex items-center">{{ svg( '@webroot/dist/img/icon-calendar-new.svg') }} <span class="ml-2">{{ entry.date.format("l, F d, Y") }}</span></p>
        <p class="flex items-center pt-1">{{ svg( '@webroot/dist/img/icon-clock.svg') }} <span class="ml-2">{{ entry.startDate.format("g:ia") }}{{ entry.endDate ? " to " ~ entry.endDate.format("g:ia") : '' }}</span></p>
      {% else %}
        <p class="flex items-center">{{ svg( '@webroot/dist/img/icon-calendar-new.svg') }} <span class="ml-2">{{ entry.date.format("l, F d, Y") }}</span></p>
        <p class="flex items-center pt-1">{{ svg( '@webroot/dist/img/icon-clock.svg') }} <span class="ml-2">{{ entry.startTime.format("g:ia") }}{{ entry.endTime ? " to " ~ entry.endTime.format("g:ia") : '' }}</span></p>
      {% endif %}
    </a>
    {% endfor %}
  </div>
  <div class="pt-3">
    {% if not block.hideReadMoreLink %}
      {% if entry.section.handle == 'boardsCommissions' %}
        <a class="mt-6 button small secondary" href="{{ entry.url ~ '/meetings' }}">View All Meetings, Minutes & Agendas »</a>
      {% else %}
        <a class="mt-6 button small secondary" href="{{ siteUrl ~ 'meetings' }}">View All Meetings, Minutes & Agendas »</a>
      {% endif %}
    {% endif %}
  </div>
</div>

