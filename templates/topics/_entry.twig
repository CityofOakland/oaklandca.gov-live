{% extends '_layouts/_banner-with-nav.twig' %}

{% do craft.app.elements.eagerLoadElements(
  className(entry),
  [entry],
  [
    'banner',
    'addresses',
    'contentBuilder',
    'portrait',
    'teams',
    'phoneNumbers',
    'openHours',
    'contentBuilder.largeEntryLinks:entries',
    'contentBuilder.largeEntryLinks:entries.documentFile',
    'contentBuilder.smallEntryLinks:entries',
    'contentBuilder.smallEntryLinks:entries.documentFile',
    'contentBuilder.officials.officials,'
  ]
) %}

{% set relatedEvents    = craft.calendar.events.relatedTo(entry) %}
{% set relatedNews      = craft.entries.section('news').relatedTo(entry) %}

{% set contactState = entry.addresses | length or entry.phoneNumbers | length or entry.emailAddress | length or entry.openHours | length %}
{% set contentBuilder = entry.contentBuilder | length %}
{% set about = entry.about | length %}
{% set contact = contactState %}

{% block content %}
  {% set breadcrumbs = [] %}
  {% if entry.primaryUnit|length %}
    {% set breadcrumbs = breadcrumbs|merge([
      {
        title: entry.primaryUnit.one().title,
        link: entry.primaryUnit.one().url
      },
    ]) %}
  {% endif %}
  {% if entry.section %}
    {% set breadcrumbs = breadcrumbs|merge([
      {
        title: entry.section.name,
        link: siteUrl ~ entry.section.handle
      },
    ]) %}
  {% endif %}
  {% include '_partials/_page-banners.twig' with {
    breadCrumbLinks: breadcrumbs,
    bannerImage: entry.banner | length ? {
      position: entry.banner[0].getFocalPoint('asCss'),
      src: entry.banner[0].url,
      alt: entry.banner[0].title ?? entry.banner[0].filename
    } : false
  } %}
  <div class="container pt-0">
    <div class="flex">
      {% set disableRelatedPages = true %}
      {% include "_partials/_elements/_nav-sidebar.twig" %}
      <div class="flex-1">
        {% if entry.accordion|length %}
          <div class="mb-12">
            <div id="page-accordion" class="relative -top-16"></div>
            {% if entry.accordionHeader %}<h2 class="text-2xl mb-0">{{ entry.accordionHeader }}</h2>{% endif %}
            {% include '_components/_accordion.twig' with {accordion: entry.accordion.all()} %}
          </div>
        {% endif %}
        {% if entry.process|length %}
          <div class="mb-12">
            <div id="page-process" class="relative -top-16"></div>
            {% if entry.processHeader %}<h2 class="text-2xl my-6">{{ entry.processHeader }}</h2>{% endif %}
            {% include '_components/_process.twig' %}
          </div>
        {% endif %}
        {% include '_partials/_content-builder/_tool.twig' %}

        {% if about %}
          {% include '_partials/_page-about.twig' %}
        {% endif %}
        {% include '_partials/_page-location.twig' %}
      </div>
    </div>
  </div>
{% endblock %}
